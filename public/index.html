<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat app</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="container">

        <h1 class="heading-1">Chat app</h1>

        <div class="chat-box">

            <div class="chat-send-message">
                <h2 class="heading-2">Wyślij wiadomość</h2>

                <input class="name-input" name="name" type="text" placeholder="Nazwa">
                <div class="border-line"></div>

                <textarea class="message-input" name="message" type="text" placeholder="Wiadomość" rows="1"></textarea>
                <div class="border-line"></div>

                <button class="send">Wyślij</button>
            </div>

        </div>

        <div class="chat-messages">

            <!-- <h3 class="name">Dominik</h3>
            <p class="message">Witam</p> -->

        </div>

    </div>

    <script>

        window.onload=() => {

            const chatMsgBox=document.querySelector('.chat-messages')
            const chatName=document.querySelector('.name-input');
            const chatMsg=document.querySelector('.message-input');
            const send=document.querySelector('.send');

            function addMessages(message) {
                chatMsgBox.innerHTML+=`
                <div class="message-box">
                <h3 class="name">${message.name}</h3>
                <p class="message">${message.message}
                </div>
                `;
            }

            // Funkcja pobierające dane z adresu
            function getMessages() {
                fetch('http://localhost:3000/messages')
                    .then(function (data) {
                        return data.json();
                    })
                    .then(function (messages) {
                        if (messages=='') {
                            chatMsgBox.innerHTML+=`
                                <p class="no-messages">Brak wiadomości</p>
                            `;
                        }
                        messages.forEach(addMessages);
                    })
            }

            function postMessage(message) {
                fetch('http://localhost:3000/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(message)
                }).then(res => {
                    console.log('Request complete! response:', res);
                });
            }

            send.addEventListener('click', () => {
                let message={
                    name: `${chatName.value}`,
                    message: `${chatMsg.value}`
                };
                postMessage(message);
                chatMsg.value='';
                chatMsgBox.scrollTop=chatMsgBox.scrollHeight;
            });

            getMessages();

            setTimeout(function () {
                chatMsgBox.scrollTop=chatMsgBox.scrollHeight;
            }, 1000);

        }

    </script>

</body>

</html>